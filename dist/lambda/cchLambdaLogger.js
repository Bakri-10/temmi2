"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CCHLambdaLogger = void 0;
class CCHLambdaLogger {
    constructor(stagePrefix, region, account, cchVersion, context, kinesisEnabled, customerPrefix, customerZone, executionId, subflowExecutionId, fcchExecutionId, producerId) {
        this.counter = 0;
        this.stagePrefix = stagePrefix;
        this.region = region;
        this.account = account;
        this.cchVersion = cchVersion;
        this.customerPrefix = customerPrefix;
        this.customerZone = customerZone;
        this.executionId = executionId;
        this.context = context;
        this.kinesisEnabled = kinesisEnabled;
        this.subflowExecutionId = subflowExecutionId;
        this.fcchExecutionId = fcchExecutionId;
        this.producerId = producerId;
        console.log(`CCHLambdaLogger initialised with counter: ${this.counter}, stageprefix: ${this.stagePrefix}, region: ${this.region}, `, `account: ${this.account}, cchVersion: ${this.cchVersion}, customerPrefix: ${this.customerPrefix}, customerZone: ${customerZone}, executionId: ${this.executionId} `, `context: ${JSON.stringify(this.context, undefined, 2)}, kinesisEnabled: ${this.kinesisEnabled}, subflowExecutionId: ${this.subflowExecutionId}, fcchExecutionId: ${this.fcchExecutionId}, producerId: ${this.producerId}`);
    }
    error(errorOutput = "") {
        let errorPrefix = "ERROR";
        if (this.kinesisEnabled === "true") {
            this.kinesisOut("", `ERROR - ${JSON.stringify(errorOutput)}`);
        }
        else {
            console.error(errorPrefix, JSON.stringify(errorOutput, undefined, 2));
        }
    }
    log(logPrefix, logOutput) {
        if (this.kinesisEnabled === "true") {
            if (typeof logOutput === 'undefined' || logOutput === null) {
                this.kinesisOut(`${logPrefix}`, "");
            }
            else {
                this.kinesisOut(`${logPrefix} - ${JSON.stringify(logOutput)}`, "");
            }
        }
        else {
            console.log(logPrefix, JSON.stringify(logOutput, undefined, 2));
        }
    }
    formatAWSServiceURL() {
        const generatedURL = `https://${this.region}.console.aws.amazon.com/cloudwatch/home?region=${this.region}#logsV2:log-groups/log-group/` +
            `${this.context.logGroupName.replace(/\//ig, "$252F")}` +
            `/log-events/` +
            `${this.context.logStreamName.replace("$", "").replace(/\//ig, "$252F").replace("[", "$255B$2524").replace("]", "$255D")}`;
        return generatedURL;
    }
    kinesisOut(logOutput, errorOutput) {
        let transactionId;
        if (!this.producerId ||
            this.producerId === undefined ||
            this.producerId === '') {
            transactionId = `${this.context.invokedFunctionArn}:${this.context.awsRequestId}`;
        }
        else {
            transactionId = this.producerId;
        }
        try {
            console.log(JSON.stringify({
                "dataType": "INTERNAL",
                "spanName": this.context.functionName,
                "parentId": this.subflowExecutionId ? this.subflowExecutionId : this.fcchExecutionId,
                "sourceDetail": "lambda",
                "source": "FCCH",
                "userIdentifier": "fcch-operator",
                "time": Date.parse(new Date()),
                "transactionId": transactionId,
                "schemaVersion": "1.0.0",
                "zoneType": "INTERNAL",
                "additionalData": {
                    "zone": this.customerZone ? this.customerZone : "",
                    "accountIdentifier": this.account,
                    "awsRegion": this.region,
                    "environment": this.stagePrefix,
                    "softwareVersion": this.cchVersion,
                    "log": logOutput.replace(/\\"/g, ""),
                    "exception": errorOutput,
                    "logGroup": this.context.logGroupName,
                    "logStream": this.context.logStreamName,
                    "awsServiceURL": this.formatAWSServiceURL(),
                    "awsService": "lambda",
                    "customer": this.customerPrefix,
                    "fcchExecutionId": this.fcchExecutionId,
                    "startTime": Date.parse(new Date()),
                    "executionContext": "TASK",
                    "subOrderId": this.counter
                }
            }));
            this.counter++;
        }
        catch (err) {
            console.error(err);
        }
    }
}
exports.CCHLambdaLogger = CCHLambdaLogger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2NoTGFtYmRhTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGFtYmRhL2NjaExhbWJkYUxvZ2dlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQyxNQUFhLGVBQWU7SUFDekIsWUFBWSxXQUFXLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFDckUsY0FBYyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsa0JBQWtCLEVBQUUsZUFBZSxFQUFFLFVBQVU7UUFDOUYsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDckMsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDckMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGtCQUFrQixDQUFDO1FBQzdDLElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBRTdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTZDLElBQUksQ0FBQyxPQUFPLGtCQUFrQixJQUFJLENBQUMsV0FBVyxhQUFhLElBQUksQ0FBQyxNQUFNLElBQUksRUFDL0gsWUFBWSxJQUFJLENBQUMsT0FBTyxpQkFBaUIsSUFBSSxDQUFDLFVBQVUscUJBQXFCLElBQUks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QyxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDbEI7UUFBQSxPQUFNLEdBQUcsRUFBQztZQUNQLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDdEI7SUFDTCxDQUFDO0NBQ0o7QUF0R0EsMENBc0dBIiwic291cmNlc0NvbnRlbnQiOlsiIGV4cG9ydCBjbGFzcyBDQ0hMYW1iZGFMb2dnZXIge1xyXG4gICAgY29uc3RydWN0b3Ioc3RhZ2VQcmVmaXgsIHJlZ2lvbiwgYWNjb3VudCwgY2NoVmVyc2lvbiwgY29udGV4dCwga2luZXNpc0VuYWJsZWQsXHJcbiAgICAgICAgICAgIGN1c3RvbWVyUHJlZml4LCBjdXN0b21lclpvbmUsIGV4ZWN1dGlvbklkLCBzdWJmbG93RXhlY3V0aW9uSWQsIGZjY2hFeGVjdXRpb25JZCwgcHJvZHVjZXJJZCkge1xyXG4gICAgICAgIHRoaXMuY291bnRlciA9IDA7XHJcbiAgICAgICAgdGhpcy5zdGFnZVByZWZpeCA9IHN0YWdlUHJlZml4O1xyXG4gICAgICAgIHRoaXMucmVnaW9uID0gcmVnaW9uO1xyXG4gICAgICAgIHRoaXMuYWNjb3VudCA9IGFjY291bnQ7XHJcbiAgICAgICAgdGhpcy5jY2hWZXJzaW9uID0gY2NoVmVyc2lvbjtcclxuICAgICAgICB0aGlzLmN1c3RvbWVyUHJlZml4ID0gY3VzdG9tZXJQcmVmaXg7XHJcbiAgICAgICAgdGhpcy5jdXN0b21lclpvbmUgPSBjdXN0b21lclpvbmU7XHJcbiAgICAgICAgdGhpcy5leGVjdXRpb25JZCA9IGV4ZWN1dGlvbklkO1xyXG4gICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5raW5lc2lzRW5hYmxlZCA9IGtpbmVzaXNFbmFibGVkO1xyXG4gICAgICAgIHRoaXMuc3ViZmxvd0V4ZWN1dGlvbklkID0gc3ViZmxvd0V4ZWN1dGlvbklkO1xyXG4gICAgICAgIHRoaXMuZmNjaEV4ZWN1dGlvbklkID0gZmNjaEV4ZWN1dGlvbklkO1xyXG4gICAgICAgIHRoaXMucHJvZHVjZXJJZCA9IHByb2R1Y2VySWQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2coYENDSExhbWJkYUxvZ2dlciBpbml0aWFsaXNlZCB3aXRoIGNvdW50ZXI6ICR7dGhpcy5jb3VudGVyfSwgc3RhZ2VwcmVmaXg6ICR7dGhpcy5zdGFnZVByZWZpeH0sIHJlZ2lvbjogJHt0aGlzLnJlZ2lvbn0sIGAsXHJcbiAgICAgICAgICAgIGBhY2NvdW50OiAke3RoaXMuYWNjb3VudH0sIGNjaFZlcnNpb246ICR7dGhpcy5jY2hWZXJzaW9ufSwgY3VzdG9tZXJQcmVmaXg6ICR7dGhpcy5jdXN0b21lclByZWZpeH0sIGN1c3RvbWVyWm9uZTogJHtjdXN0b21lclpvbmV9LCBleGVjdXRpb25JZDogJHt0aGlzLmV4ZWN1dGlvbklkfSBgLCBcclxuICAgICAgICAgICAgYGNvbnRleHQ6ICR7SlNPTi5zdHJpbmdpZnkodGhpcy5jb250ZXh0LHVuZGVmaW5lZCwyKX0sIGtpbmVzaXNFbmFibGVkOiAke3RoaXMua2luZXNpc0VuYWJsZWR9LCBzdWJmbG93RXhlY3V0aW9uSWQ6ICR7dGhpcy5zdWJmbG93RXhlY3V0aW9uSWR9LCBmY2NoRXhlY3V0aW9uSWQ6ICR7dGhpcy5mY2NoRXhlY3V0aW9uSWR9LCBwcm9kdWNlcklkOiAke3RoaXMucHJvZHVjZXJJZH1gKTtcclxuICAgIH1cclxuXHJcbiAgICBlcnJvcihlcnJvck91dHB1dD1cIlwiKXtcclxuICAgICAgICBsZXQgZXJyb3JQcmVmaXggPSBcIkVSUk9SXCI7XHJcbiAgICAgICAgaWYodGhpcy5raW5lc2lzRW5hYmxlZCA9PT0gXCJ0cnVlXCIpe1xyXG4gICAgICAgICAgICB0aGlzLmtpbmVzaXNPdXQoXCJcIiwgYEVSUk9SIC0gJHtKU09OLnN0cmluZ2lmeShlcnJvck91dHB1dCl9YCk7ICAgICAgICAgIFxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yUHJlZml4LCBKU09OLnN0cmluZ2lmeShlcnJvck91dHB1dCwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxvZyhsb2dQcmVmaXgsIGxvZ091dHB1dCl7XHJcbiAgICAgICAgaWYodGhpcy5raW5lc2lzRW5hYmxlZCA9PT0gXCJ0cnVlXCIpe1xyXG4gICAgICAgICAgICBpZiggdHlwZW9mIGxvZ091dHB1dCA9PT0gJ3VuZGVmaW5lZCcgfHwgbG9nT3V0cHV0ID09PSBudWxsICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5raW5lc2lzT3V0KGAke2xvZ1ByZWZpeH1gLCBcIlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMua2luZXNpc091dChgJHtsb2dQcmVmaXh9IC0gJHtKU09OLnN0cmluZ2lmeShsb2dPdXRwdXQpfWAsIFwiXCIpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICBcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobG9nUHJlZml4LCBKU09OLnN0cmluZ2lmeShsb2dPdXRwdXQsIHVuZGVmaW5lZCwgMikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXRBV1NTZXJ2aWNlVVJMKCl7XHJcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVkVVJMID0gYGh0dHBzOi8vJHt0aGlzLnJlZ2lvbn0uY29uc29sZS5hd3MuYW1hem9uLmNvbS9jbG91ZHdhdGNoL2hvbWU/cmVnaW9uPSR7dGhpcy5yZWdpb259I2xvZ3NWMjpsb2ctZ3JvdXBzL2xvZy1ncm91cC9gICsgXHJcbiAgICAgICAgYCR7dGhpcy5jb250ZXh0LmxvZ0dyb3VwTmFtZS5yZXBsYWNlKC9cXC8vaWcsIFwiJDI1MkZcIil9YCArXHJcbiAgICAgICAgYC9sb2ctZXZlbnRzL2AgKyBcclxuICAgICAgICBgJHt0aGlzLmNvbnRleHQubG9nU3RyZWFtTmFtZS5yZXBsYWNlKFwiJFwiLCBcIlwiKS5yZXBsYWNlKC9cXC8vaWcsIFwiJDI1MkZcIikucmVwbGFjZShcIltcIiwgXCIkMjU1QiQyNTI0XCIpLnJlcGxhY2UoXCJdXCIsIFwiJDI1NURcIil9YFxyXG5cclxuICAgICAgICByZXR1cm4gZ2VuZXJhdGVkVVJMO1xyXG4gICAgfVxyXG5cclxuICAgIGtpbmVzaXNPdXQobG9nT3V0cHV0LCBlcnJvck91dHB1dCl7XHJcbiAgICAgICAgbGV0IHRyYW5zYWN0aW9uSWQ7XHJcblxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgIXRoaXMucHJvZHVjZXJJZCB8fFxyXG4gICAgICAgICAgICB0aGlzLnByb2R1Y2VySWQgPT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgICAgICB0aGlzLnByb2R1Y2VySWQgPT09ICcnXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uSWQgPSBgJHt0aGlzLmNvbnRleHQuaW52b2tlZEZ1bmN0aW9uQXJufToke3RoaXMuY29udGV4dC5hd3NSZXF1ZXN0SWR9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbklkID0gdGhpcy5wcm9kdWNlcklkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHJ5eyAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIFwiZGF0YVR5cGVcIjogXCJJTlRFUk5BTFwiLFxyXG4gICAgICAgICAgICBcInNwYW5OYW1lXCI6IHRoaXMuY29udGV4dC5mdW5jdGlvbk5hbWUsXHJcbiAgICAgICAgICAgIFwicGFyZW50SWRcIjogdGhpcy5zdWJmbG93RXhlY3V0aW9uSWQgPyB0aGlzLnN1YmZsb3dFeGVjdXRpb25JZCA6IHRoaXMuZmNjaEV4ZWN1dGlvbklkLFxyXG4gICAgICAgICAgICBcInNvdXJjZURldGFpbFwiOiBcImxhbWJkYVwiLFxyXG4gICAgICAgICAgICBcInNvdXJjZVwiOiBcIkZDQ0hcIixcclxuICAgICAgICAgICAgXCJ1c2VySWRlbnRpZmllclwiOiBcImZjY2gtb3BlcmF0b3JcIixcclxuICAgICAgICAgICAgXCJ0aW1lXCI6IERhdGUucGFyc2UobmV3IERhdGUoKSksXHJcbiAgICAgICAgICAgIFwidHJhbnNhY3Rpb25JZFwiOiB0cmFuc2FjdGlvbklkLFxyXG4gICAgICAgICAgICBcInNjaGVtYVZlcnNpb25cIjogXCIxLjAuMFwiLFxyXG4gICAgICAgICAgICBcInpvbmVUeXBlXCI6IFwiSU5URVJOQUxcIixcclxuICAgICAgICAgICAgXCJhZGRpdGlvbmFsRGF0YVwiOiB7XHJcbiAgICAgICAgICAgICAgICBcInpvbmVcIjogdGhpcy5jdXN0b21lclpvbmUgPyB0aGlzLmN1c3RvbWVyWm9uZSA6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcImFjY291bnRJZGVudGlmaWVyXCI6IHRoaXMuYWNjb3VudCxcclxuICAgICAgICAgICAgICAgIFwiYXdzUmVnaW9uXCI6IHRoaXMucmVnaW9uLFxyXG4gICAgICAgICAgICAgICAgXCJlbnZpcm9ubWVudFwiOiB0aGlzLnN0YWdlUHJlZml4LFxyXG4gICAgICAgICAgICAgICAgXCJzb2Z0d2FyZVZlcnNpb25cIjogdGhpcy5jY2hWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgXCJsb2dcIjogbG9nT3V0cHV0LnJlcGxhY2UoL1xcXFxcIi9nLCBcIlwiKSxcclxuICAgICAgICAgICAgICAgIFwiZXhjZXB0aW9uXCI6IGVycm9yT3V0cHV0LFxyXG4gICAgICAgICAgICAgICAgXCJsb2dHcm91cFwiOiB0aGlzLmNvbnRleHQubG9nR3JvdXBOYW1lLFxyXG4gICAgICAgICAgICAgICAgXCJsb2dTdHJlYW1cIjogdGhpcy5jb250ZXh0LmxvZ1N0cmVhbU5hbWUsXHJcbiAgICAgICAgICAgICAgICBcImF3c1NlcnZpY2VVUkxcIjogdGhpcy5mb3JtYXRBV1NTZXJ2aWNlVVJMKCksXHJcbiAgICAgICAgICAgICAgICBcImF3c1NlcnZpY2VcIjogXCJsYW1iZGFcIixcclxuICAgICAgICAgICAgICAgIFwiY3VzdG9tZXJcIjogdGhpcy5jdXN0b21lclByZWZpeCxcclxuICAgICAgICAgICAgICAgIFwiZmNjaEV4ZWN1dGlvbklkXCI6IHRoaXMuZmNjaEV4ZWN1dGlvbklkLFxyXG4gICAgICAgICAgICAgICAgXCJzdGFydFRpbWVcIjogRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKSxcclxuICAgICAgICAgICAgICAgIFwiZXhlY3V0aW9uQ29udGV4dFwiOiBcIlRBU0tcIixcclxuICAgICAgICAgICAgICAgIFwic3ViT3JkZXJJZFwiOiB0aGlzLmNvdW50ZXJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHRoaXMuY291bnRlcisrO1xyXG4gICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuICBcclxuICAiXX0=